import{a as L,b as M}from"./chunk-M37KSZX3.js";import{j as S}from"./chunk-5AEJKQZ7.js";import{l as o,m as N}from"./chunk-33ESLUTY.js";import"./chunk-MFF7C7S5.js";import"./chunk-QU4V2ODD.js";import{c as p,g as n}from"./chunk-4DGYJU6A.js";import{b as g}from"./chunk-JRHJ5E23.js";import"./chunk-7XYIQRBA.js";import{c as P,d as I}from"./chunk-ZDDZZI4Y.js";import{l as w}from"./chunk-ZEZBUIIC.js";import{$ as T,Sb as b,Tb as c,Ub as u,Vb as v,ac as F,db as h,fc as A,la as C,lc as _,mc as D,nc as E,qb as y,ra as s,sa as m,wc as V}from"./chunk-D2MV77EI.js";var x=["modal"],W=(()=>{let l=class l{constructor(){this._ServiceLifeTime=C(P),this._AppModeService=C(g),this._Apiservice=C(I),this.EventArr=[{Name:"Tree",OnClick:()=>this.OpenTree()}],this.TablePaging={PageTitle:"AccTree.AccTree",Url:"Global/GetAll",TableName:"AccTree",AddUrl:"AccountTreeEP/Add",UpdateUrl:"AccountTreeEP/Update",DeleteUrl:"AccountTreeEP/Delete",GetById:"AccountTreeEP/GetById",Join:!0,JoinTables:["AccTree Parent"],JoinConditions:["T.ParentId = Parent.Id"],Columns:["T.Id","T.Code","T.NameAr","T.NameEn","T.ParentId",this._Apiservice.Language=="ar"?"Parent.NameAr As ParentName":"Parent.NameEn As ParentName"],TableCell:[{CellName:"NameAr",SortName:"T.NameAr",KeyValue:"NameAr"},{CellName:"NameEn",SortName:"T.NameEn",KeyValue:"NameEn"},{CellName:"Code",SortName:"T.Code",KeyValue:"Code"},{CellName:"Parent",SortName:this._Apiservice.Language=="ar"?"Parent.NameAr":"Parent.NameEn",KeyValue:"ParentName"}]},this.Data=[{Type:"Tabs",TabName:"Basic Data",Tabs:[{TabName:"Data",TabData:[{FiledType:o.input,InputType:N.Text,FormControl:new n("",[p.required]),Required:!0,LableName:"NameAr",ValueField:"NameAr"},{FiledType:o.input,InputType:N.Text,FormControl:new n("",[p.required]),Required:!0,LableName:"NameEn",ValueField:"NameEn"},{FiledType:o.DropDownApi,FormControl:new n(null),LableName:"Parent",Url:"Global/GetAll",TableName:"AccTree",Columns:["Id","NameAr","NameEn"],ValueField:"ParentId",ValueFieldName:"ParentName",OnChange:()=>this.ChangeParent()},{FiledType:o.input,InputType:N.Text,FormControl:new n({value:null,disabled:!0},[p.required]),LableName:"Code",ValueField:"Code"},{FiledType:o.StaticDropDown,FormControl:new n(null,[p.required]),LableName:"\u0645\u0643\u0627\u0646 \u0627\u0644\u0627\u0642\u0641\u0627\u0644",ValueField:"ClassType",Required:!0,SaveData:!0,ResponseData:[{Id:1,NameAr:"\u0645\u062C\u0645\u0644 \u0627\u0644\u0631\u0628\u062D - \u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u062F\u062E\u0644",NameEn:"Gross Profit"},{Id:2,NameAr:"\u0627\u0631\u0628\u0627\u062D \u0648\u062E\u0633\u0627\u0626\u0631  - \u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u062F\u062E\u0644",NameEn:"Profit And Loss Statement"},{Id:3,NameAr:"\u0627\u0644\u0645\u064A\u0632\u0627\u0646\u064A\u0629",NameEn:"Balance Sheet"}]},{FiledType:o.StaticDropDown,FormControl:new n(null,[p.required]),LableName:"\u0637\u0628\u064A\u0639\u0629 \u0627\u0644\u062D\u0633\u0627\u0628",ValueField:"Poses",Required:!0,SaveData:!0,ResponseData:[{Id:!1,NameAr:"\u0645\u062F\u064A\u0646",NameEn:"Debit"},{Id:!0,NameAr:"\u062F\u0627\u0626\u0646",NameEn:"Credit"}]},{FiledType:o.Checkbox,FormControl:new n(!1),LableName:"AccTree.CostCenter",ValueField:"IsCostCenter"},{FiledType:o.Checkbox,FormControl:new n(!1),LableName:"AccTree.Series",ValueField:"IsSeries"},{FiledType:o.Checkbox,FormControl:new n(!1),LableName:"AccTree.DueDate",ValueField:"IsDueDate"},{FiledType:o.Checkbox,FormControl:new n(!1),LableName:"AccTree.OtherData",ValueField:"IsOtherData"},{FiledType:o.Checkbox,FormControl:new n(!1),LableName:"AccTree.Quantity",ValueField:"IsQuantity"}]}]}],this.TreeJs=[]}ngAfterViewInit(){w(this._AppModeService._Toastr.platformId)&&(this.modalInstance=new window.bootstrap.Modal(this.modalRef.nativeElement,{keyboard:!1}))}GetCode(){let r=this.Data.flatMap(t=>t.Tabs??[]).flatMap(t=>t.TabData??[]).find(t=>t.ValueField==="Code");r&&this._Apiservice.getById("AccountTreeEP/GetCode",0,!1).pipe(T(this._ServiceLifeTime.Destroyed$)).subscribe({next:t=>{r.FormControl.setValue(t.Obj)},error:t=>{r.FormControl.setValue(null)}})}ChangeParent(){let r=this.Data.flatMap(e=>e.Tabs??[]).flatMap(e=>e.TabData??[]).find(e=>e.ValueField==="Code"),t=this.Data.flatMap(e=>e.Tabs??[]).flatMap(e=>e.TabData??[]).find(e=>e.ValueField==="ParentId");if(t&&r){let e=t.FormControl.value==null?0:t.FormControl.value;this._Apiservice.getById("AccountTreeEP/GetCode",e,!1).pipe(T(this._ServiceLifeTime.Destroyed$)).subscribe({next:a=>{r.FormControl.setValue(a.Obj)},error(a){r.FormControl.setValue(null)}})}}OpenTree(){let r={TableName:this.TablePaging.TableName,Columns:["Id","Code","NameAr","NameEn","ParentId"],Conditions:"",NoPaging:!0,BranchFilter:!0};this._Apiservice.post("Global/GetAll",r,!1).pipe(T(this._ServiceLifeTime.Destroyed$)).subscribe({next:t=>{this.HandleTree(t.Obj.DataReturn),this.modalInstance.show()}})}HandleTree(r){let t=[];for(let e=0;e<r.length;e++){let a=r[e];a.key=a.Id,a.icon="pi pi-fw pi-inbox",a.label=(this._Apiservice.Language=="ar"?a.NameAr:a.NameEn)+" - "+a.Code,a.data="Documents Folder",a.children=[],a.children=r.filter(d=>d.ParentId==a.Id),a.ParentId==null&&t.push(a)}this.TreeJs=t.sort((e,a)=>e.Code-a.Code)}nodeExpand(r){}nodeCollapse(r){}nodeSelect(r){}nodeUnselect(r){}expandRecursive(r,t){r.expanded=t,r.children&&r.children.forEach(e=>{this.expandRecursive(e,t)})}};l.\u0275fac=function(t){return new(t||l)},l.\u0275cmp=y({type:l,selectors:[["app-acc-tree"]],viewQuery:function(t,e){if(t&1&&_(x,5),t&2){let a;D(a=E())&&(e.modalRef=a.first)}},decls:12,vars:4,consts:[["modal",""],[3,"OpenModalEvent","DataView","EventArr","TablePaging"],["id","modalCenter","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header","p-0","m-0"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body","p-0","text-center"],["selectionMode","single",1,"w-full",3,"onNodeExpand","onNodeCollapse","onNodeSelect","onNodeUnselect","value"],[1,"modal-footer","p-1"],["type","button","data-bs-dismiss","modal",1,"btn","btn-outline-secondary"]],template:function(t,e){if(t&1){let a=F();c(0,"app-dynamic-component",1),A("OpenModalEvent",function(){return s(a),m(e.GetCode())}),u(),c(1,"div",2,0)(3,"div",3)(4,"div",4)(5,"div",5),v(6,"button",6),u(),c(7,"div",7)(8,"p-tree",8),A("onNodeExpand",function(i){return s(a),m(e.nodeExpand(i))})("onNodeCollapse",function(i){return s(a),m(e.nodeCollapse(i))})("onNodeSelect",function(i){return s(a),m(e.nodeSelect(i))})("onNodeUnselect",function(i){return s(a),m(e.nodeUnselect(i))}),u()(),c(9,"div",9)(10,"button",10),V(11," Close "),u()()()()()}t&2&&(b("DataView",e.Data)("EventArr",e.EventArr)("TablePaging",e.TablePaging),h(8),b("value",e.TreeJs))},dependencies:[S,M,L],encapsulation:2});let f=l;return f})();export{W as AccTreeComponent};
