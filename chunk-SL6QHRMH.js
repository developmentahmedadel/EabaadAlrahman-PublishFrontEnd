import{a as M,b as L}from"./chunk-URHXBJU5.js";import{s as S}from"./chunk-H57CXEHO.js";import{m as C,n as f}from"./chunk-LOIQGRQV.js";import"./chunk-P6OF4AA2.js";import"./chunk-JGOL2J3N.js";import"./chunk-GAJKBRCZ.js";import"./chunk-VY63KLUP.js";import{c as s,g as u}from"./chunk-PPZW3Y2M.js";import{b as I}from"./chunk-GQXGXWG7.js";import"./chunk-SNBE23HG.js";import{c as F,d as D}from"./chunk-JHZULCF3.js";import{l as w}from"./chunk-KYBQWAB6.js";import{Ob as b,Pb as m,Qb as p,Rb as y,Yb as g,aa as c,bc as h,db as v,hc as A,ic as P,jc as E,la as T,qb as _,ra as l,sa as d,sc as V}from"./chunk-MVQPZUAI.js";var U=["modal"],W=(()=>{let r=class r{constructor(){this._ServiceLifeTime=T(F),this._AppModeService=T(I),this._Apiservice=T(D),this.EventArr=[{Name:"Tree",OnClick:()=>this.OpenTree()}],this.TablePaging={PageTitle:"CostCenter.CostCenter",Url:"Global/GetAll",TableName:"CostCenter",AddUrl:"CostCenterEP/Add",UpdateUrl:"CostCenterEP/Update",DeleteUrl:"CostCenterEP/Delete",Join:!0,JoinTables:["CostCenter Parent"],JoinConditions:["T.ParentId = Parent.Id"],Columns:["T.Id","T.Code","T.NameAr","T.NameEn","T.ParentId",this._Apiservice.Language=="ar"?"Parent.NameAr As ParentName":"Parent.NameEn As ParentName"],TableCell:[{CellName:"NameAr",SortName:"T.NameAr",KeyValue:"NameAr"},{CellName:"NameEn",SortName:"T.NameEn",KeyValue:"NameEn"},{CellName:"Code",SortName:"T.Code",KeyValue:"Code"},{CellName:"Parent",SortName:this._Apiservice.Language=="ar"?"Parent.NameAr":"Parent.NameEn",KeyValue:"ParentName"}]},this.Data=[{Type:"Tabs",TabName:"Basic Data",Tabs:[{TabName:"Data",TabData:[{FiledType:C.input,InputType:f.Text,FormControl:new u("",[s.required,s.maxLength(250)]),Required:!0,LableName:"NameAr",ValueField:"NameAr"},{FiledType:C.input,InputType:f.Text,FormControl:new u("",[s.required,s.maxLength(250)]),Required:!0,LableName:"NameEn",ValueField:"NameEn"},{FiledType:C.DropDownApi,FormControl:new u(null),LableName:"Parent",Url:"Global/GetAll",TableName:"CostCenter",Columns:["Id","NameAr","NameEn"],ValueField:"ParentId",ValueFieldName:"ParentName",OnChange:()=>this.ChangeParent()},{FiledType:C.input,InputType:f.Text,FormControl:new u({value:null,disabled:!0},[s.required]),LableName:"Code",ValueField:"Code"}]}]}],this.TreeJs=[]}ngAfterViewInit(){w(this._AppModeService._Toastr.platformId)&&(this.modalInstance=new window.bootstrap.Modal(this.modalRef.nativeElement,{keyboard:!1}))}GetCode(){let a=this.Data.flatMap(t=>t.Tabs??[]).flatMap(t=>t.TabData??[]).find(t=>t.ValueField==="Code");a&&this._Apiservice.getById("CostCenterEP/GetCode",0,!1).pipe(c(this._ServiceLifeTime.Destroyed$)).subscribe({next:t=>{a.FormControl.setValue(t.Obj)},error(t){a.FormControl.setValue(null)}})}ChangeParent(){let a=this.Data.flatMap(e=>e.Tabs??[]).flatMap(e=>e.TabData??[]).find(e=>e.ValueField==="Code"),t=this.Data.flatMap(e=>e.Tabs??[]).flatMap(e=>e.TabData??[]).find(e=>e.ValueField==="ParentId");if(t&&a){let e=t.FormControl.value==null?0:t.FormControl.value;this._Apiservice.getById("CostCenterEP/GetCode",e,!1).pipe(c(this._ServiceLifeTime.Destroyed$)).subscribe({next:n=>{a.FormControl.setValue(n.Obj)},error(n){a.FormControl.setValue(null)}})}}OpenTree(){let a={TableName:this.TablePaging.TableName,Columns:["Id","Code","NameAr","NameEn","ParentId"],Conditions:"",NoPaging:!0,BranchFilter:!0};this._Apiservice.post("Global/GetAll",a,!1).pipe(c(this._ServiceLifeTime.Destroyed$)).subscribe({next:t=>{this.HandleTree(t.Obj.DataReturn),this.modalInstance.show()}})}HandleTree(a){let t=[];for(let e=0;e<a.length;e++){let n=a[e];n.key=n.Id,n.icon="pi pi-fw pi-inbox",n.label=(this._Apiservice.Language=="ar"?n.NameAr:n.NameEn)+" - "+n.Code,n.data="Documents Folder",n.children=[],n.children=a.filter(i=>i.ParentId==n.Id),n.ParentId==null&&t.push(n)}this.TreeJs=t.sort((e,n)=>e.Code-n.Code)}nodeExpand(a){}nodeCollapse(a){}nodeSelect(a){}nodeUnselect(a){}expandRecursive(a,t){a.expanded=t,a.children&&a.children.forEach(e=>{this.expandRecursive(e,t)})}};r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=_({type:r,selectors:[["app-cost-center"]],viewQuery:function(t,e){if(t&1&&A(U,5),t&2){let n;P(n=E())&&(e.modalRef=n.first)}},decls:12,vars:4,consts:[["modal",""],[3,"OpenModalEvent","DataView","EventArr","TablePaging"],["id","modalCenter","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header","p-0","m-0"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body","p-0","text-center"],["selectionMode","single",1,"w-full",3,"onNodeExpand","onNodeCollapse","onNodeSelect","onNodeUnselect","value"],[1,"modal-footer","p-1"],["type","button","data-bs-dismiss","modal",1,"btn","btn-outline-secondary"]],template:function(t,e){if(t&1){let n=g();m(0,"app-dynamic-component",1),h("OpenModalEvent",function(){return l(n),d(e.GetCode())}),p(),m(1,"div",2,0)(3,"div",3)(4,"div",4)(5,"div",5),y(6,"button",6),p(),m(7,"div",7)(8,"p-tree",8),h("onNodeExpand",function(o){return l(n),d(e.nodeExpand(o))})("onNodeCollapse",function(o){return l(n),d(e.nodeCollapse(o))})("onNodeSelect",function(o){return l(n),d(e.nodeSelect(o))})("onNodeUnselect",function(o){return l(n),d(e.nodeUnselect(o))}),p()(),m(9,"div",9)(10,"button",10),V(11," Close "),p()()()()()}t&2&&(b("DataView",e.Data)("EventArr",e.EventArr)("TablePaging",e.TablePaging),v(8),b("value",e.TreeJs))},dependencies:[S,L,M],encapsulation:2});let N=r;return N})();export{W as CostCenterComponent};
