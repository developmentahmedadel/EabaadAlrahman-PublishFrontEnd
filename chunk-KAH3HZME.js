import{f as B,g as H,h as J,i as W,k as z}from"./chunk-AZ3EEFSR.js";import{l as m,m as h,n as K,q as Q}from"./chunk-ROFEF2KK.js";import"./chunk-HL64DI7A.js";import"./chunk-WCDNZ3YO.js";import{c as S,f as U,g as p}from"./chunk-U5L6WCFP.js";import{b as q}from"./chunk-M24T55PI.js";import{c as $,d as k}from"./chunk-U7PEEWY4.js";import{c as x,d as P}from"./chunk-PPVSNP54.js";import{c as M}from"./chunk-HQM7P7KV.js";import{$ as I,Kc as f,Lc as y,Nb as l,Ob as i,Pb as o,Qb as c,Xb as F,ac as C,cb as a,cc as A,gc as N,hc as w,ic as G,ka as E,mc as L,pb as b,qa as u,ra as d,rc as _,sc as g,tc as V,ub as R}from"./chunk-2HPX3BE4.js";var X=["Appovemodal"],Y=["dynamiccomponent"];function Z(T,D){if(T&1){let v=F();i(0,"tr")(1,"td")(2,"div",26)(3,"button",27),C("click",function(){u(v);let n=A();return d(n.AppendRow())}),_(4," + "),o(),i(5,"button",28),C("click",function(){let n=u(v).index,t=A();return d(t.RemoveRow(n))}),_(6," - "),o()()(),i(7,"td")(8,"app-gcdropdown",15),C("EventChange",function(){let n=u(v),t=n.$implicit,r=n.index,s=A();return d(s.AnalysisScreenChange(t.AnalysisScreenId.FormControl.value,r))}),o()(),i(9,"td"),c(10,"app-gcdropdown",13),o(),i(11,"td")(12,"app-generic-input",15),C("EventChange",function(){let n=u(v).$implicit,t=A();return n.Credit.FormControl.setValue(null),d(t.CalcTotal())}),o()(),i(13,"td")(14,"app-generic-input",15),C("EventChange",function(){let n=u(v).$implicit,t=A();return n.Debit.FormControl.setValue(null),d(t.CalcTotal())}),o()()()}if(T&2){let v=D.$implicit,e=A();a(5),l("disabled",e.GlDetails.length==1),a(3),l("InputInfo",v.AnalysisScreenId),a(2),l("InputInfo",v.ReferenceId),a(2),l("InputInfo",v.Debit),a(2),l("InputInfo",v.Credit)}}var Ie=(()=>{let D=class D{constructor(){this._ServiceLifeTime=E(x),this._FocusService=E(K),this._Apiservice=E(P),this._AppModeService=E(q),this.EventArr=[{Name:"Appove Collection",OnClick:()=>this.AppoveCollection()}],this.TablePaging={PageTitle:"Gl.Gl",Url:"Global/GetAll",TableName:"Gl",AddUrl:"GlEP/Add",UpdateUrl:"GlEP/Update",DeleteUrl:"GlEP/Delete",GetById:"GlEP/GetById",PrintUrl:"GL",Join:!0,JoinTables:["Currency Cur"],JoinConditions:["T.CurrencyId = Cur.Id"],Columns:["T.Id","T.DocNo","T.DocDate","T.ExRate","T.DrAmount","T.CrAmount","T.LocalDrAmount","T.LocalCrAmount",this._Apiservice.Language=="ar"?"Cur.NameAr As CurrencyName":"Cur.NameEn As CurrencyName",`CASE 
               WHEN T.Status = 1 THEN 0
               WHEN T.Status = 2 THEN 1
               ELSE ''
               END AS Status`],EventArr:[{Name:"Appove",OnClick:e=>this.Appove(e)},{Name:"UnAppove",OnClick:e=>this.UnAppove(e)}],TableCell:[{CellName:"Status",SortName:"T.Status",KeyValue:"Status",NoSeach:!0,DataBoolean:!0},{CellName:"DocNo",SortName:"T.DocNo",KeyValue:"DocNo"},{CellName:"DocDate",SortName:"T.DocDate",KeyValue:"DocDate",CellDate:!0},{CellName:"Gl.Currency",SortName:this._Apiservice.Language=="ar"?"Cur.NameAr":"Cur.NameEn",KeyValue:"CurrencyName"},{CellName:"ExRate",SortName:"T.ExRate",KeyValue:"ExRate"},{CellName:"Depit",SortName:"T.DrAmount",KeyValue:"DrAmount"},{CellName:"Credit",SortName:"T.CrAmount",KeyValue:"CrAmount"},{CellName:"LocalDrAmount",SortName:"T.LocalDrAmount",KeyValue:"LocalDrAmount"},{CellName:"LocalCrAmount",SortName:"T.LocalCrAmount",KeyValue:"LocalCrAmount"}]},this.GlDetails=[],this.GlForm=new U({Id:new p(0),DocNo:new p({value:"",disabled:!0}),DocDate:new p(null,[S.required]),CurrencyId:new p(null,[S.required]),DrAmount:new p({value:"0",disabled:!0}),CrAmount:new p({value:"0",disabled:!0}),LocalDrAmount:new p({value:"0",disabled:!0}),LocalCrAmount:new p({value:"0",disabled:!0}),ExRate:new p({value:"0",disabled:!0}),Notes:new p("")}),this.DocNoInput={LableName:"DocNo",FormControl:this.GlForm.get("DocNo"),FiledType:m.input,InputType:h.Text,Disabled:!0},this.DocDateInput={LableName:"DocDate",FormControl:this.GlForm.get("DocDate"),FiledType:m.DateTime},this.NotesInput={LableName:"Notes",FormControl:this.GlForm.get("Notes"),FiledType:m.input,InputType:h.Text},this.DrAmountInput={LableName:"T-Depit",FormControl:this.GlForm.get("DrAmount"),FiledType:m.input,InputType:h.Text},this.CrAmountInput={LableName:"T-Credit",FormControl:this.GlForm.get("CrAmount"),FiledType:m.input,InputType:h.Text},this.LocalDrAmountInput={LableName:"T-LocalDepit",FormControl:this.GlForm.get("LocalDrAmount"),FiledType:m.input,InputType:h.Text},this.LocalCrAmountInput={LableName:"T-LocalCredit",FormControl:this.GlForm.get("LocalCrAmount"),FiledType:m.input,InputType:h.Text},this.ExRateInput={LableName:"ExRate",FormControl:this.GlForm.get("ExRate"),FiledType:m.input,InputType:h.Text},this.CurrencyInput={LableName:"Gl.Currency",TableName:"Currency",Url:"Global/GetAll",Columns:["Id","NameAr","NameEn"],FormControl:this.GlForm.get("CurrencyId"),FiledType:m.DropDownApi},this.FromDateInput={LableName:"From",Required:!0,FormControl:new p(this._AppModeService.DateNow(),[S.required]),FiledType:m.DateTime},this.ToDateInput={LableName:"To",Required:!0,FormControl:new p(this._AppModeService.DateNow(),[S.required]),FiledType:m.DateTime},this.StatusInput={FiledType:m.StaticDropDown,FormControl:new p(null,[S.required]),LableName:"Status",Required:!0,ResponseData:[{Id:1,NameAr:"\u0623\u0644\u063A\u0627\u0621 \u0627\u0644\u0627\u0639\u062A\u0645\u0627\u062F",NameEn:"UnApprove"},{Id:2,NameAr:"\u0627\u0639\u062A\u0645\u0627\u062F",NameEn:"Approve"}]}}ChangeCurrency(){let e=this.CurrencyInput.FormControl.value,n=this.DocDateInput.FormControl.value;if(e==null||n==null){this.SetExchangeRate("0");return}let t={CurrencyId:e,Date:n};this._Apiservice.post("CurrencyEP/GetRate",t,!1).pipe(I(this._ServiceLifeTime.Destroyed$)).subscribe({next:r=>this.SetExchangeRate(r.Obj),error:()=>this.SetExchangeRate("0")})}SetExchangeRate(e){this.ExRateInput.FormControl.setValue(e),this.CalcTotal()}GetPageInfo(){this.ResetPage(),this.DateNow(),this._Apiservice.get("GlEP/GetPageInfo",!1).pipe(I(this._ServiceLifeTime.Destroyed$)).subscribe({next:e=>{this.DocNoInput.FormControl.setValue(e.Obj)}})}DateNow(){this.DocDateInput.FormControl.setValue(new Date)}AppendRow(e=null){this.GlDetails.push({AnalysisScreenId:{FormControl:new p(e!=null?e.AnalysisScreenId:null,[S.required]),FiledType:m.DropDownApi,Url:"Global/GetAll",TableName:"AnalysisScreen",Columns:["Id","NameAr","NameEn"],ValueField:"AnalysisScreenId",ValueFieldName:"AnalysisScreenName",ResponseData:e!=null?[{Id:e.AnalysisScreenId,NameAr:e.AnalysisScreenName,NameEn:e.AnalysisScreenName}]:[]},ReferenceId:{FormControl:new p(e!=null?e.ReferenceId:null),FiledType:m.DropDownApi,Url:e!=null?`AnalysisScreenEP/GetAllAnalysisScreen?Id=${e.AnalysisScreenId}`:"",Columns:["Id"],ResponseData:e!=null?[{Id:e.ReferenceId,NameAr:e.ReferenceName,NameEn:e.ReferenceName}]:[]},Debit:{FormControl:new p(e!=null?e.Debit:null),FiledType:m.input,InputType:h.Text},Credit:{FormControl:new p(e!=null?e.Credit:null),FiledType:m.input,InputType:h.Text}})}RemoveRow(e){return this.GlDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("GlManual.Error.ErrorFirstRow")),!1):(this.GlDetails.splice(e,1),this.CalcTotal(),!0)}MappingList(){return this.GlDetails.map(n=>{let t={};return Object.keys(n).forEach(r=>{t[r]=Number(n[r].FormControl?.value)??null}),t})}CalcTotal(){this.DrAmountInput.FormControl.setValue(null),this.CrAmountInput.FormControl.setValue(null),this.LocalDrAmountInput.FormControl.setValue(null),this.LocalCrAmountInput.FormControl.setValue(null);let e=Number(this.ExRateInput.FormControl.value)||0,n=this.MappingList(),t=0,r=0;n.forEach(s=>{t+=Number(s.Debit)||0,r+=Number(s.Credit)||0}),this.DrAmountInput.FormControl.setValue(t),this.CrAmountInput.FormControl.setValue(r),this.LocalDrAmountInput.FormControl.setValue(t*e),this.LocalCrAmountInput.FormControl.setValue(r*e)}AnalysisScreenChange(e,n){let t=this.GlDetails[n];t.ReferenceId.Url="",t.ReferenceId.FormControl.setValue(null),t.ReferenceId.ResponseData=[],e>0&&(t.ReferenceId.Url=`AnalysisScreenEP/GetAllAnalysisScreen?Id=${e}`)}Save(){if(this.DocDateInput.FormControl.valid==!1){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant(this.DocDateInput.LableName)),this._FocusService.focus(this.DocDateInput.FormControl);return}if(this.CurrencyInput.FormControl.valid==!1){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant(this.CurrencyInput.LableName)),this._FocusService.focus(this.CurrencyInput.FormControl);return}for(let n=0;n<this.GlDetails.length;n++){let t=this.GlDetails[n];for(let r of Object.keys(t)){let s=t[r].FormControl;if(s&&!s.valid){this._FocusService.focus(s);return}}}if(this.DrAmountInput.FormControl.value==null||this.CrAmountInput.FormControl.value==null)return;let e=this.GlForm.getRawValue();e.GlDetails=this.MappingList(),e.DocDate=this._AppModeService.ConvertISODate(this.DocDateInput.FormControl.value),e.Id==0&&this._Apiservice.post("GlEP/Add",e,!0).pipe(I(this._ServiceLifeTime.Destroyed$)).subscribe({next:n=>{this._AppModeService._Toastr.success(n.Message),this.ResetPage(),this.DynamicComponent.LoadDataPaging(!0)}}),e.Id>0&&this._Apiservice.put("GlEP/Update",e,!0).pipe(I(this._ServiceLifeTime.Destroyed$)).subscribe({next:n=>{this._AppModeService._Toastr.success(n.Message),this.ResetPage(),this.DynamicComponent.LoadDataPaging(!0)}})}ShowToEdite(e){this.ResetPage(),this.GlForm.patchValue(e),this.DocDateInput.FormControl.setValue(this._AppModeService.ConvertDateToLocal(e.DocDate)),this.CurrencyInput.ResponseData=[{Id:e.CurrencyId,NameAr:e.CurrencyName,NameEn:e.CurrencyName}],this.GlDetails=[];for(let n=0;n<e.GlDetails.length;n++){let t=e.GlDetails[n];this.AppendRow(t)}}ResetPage(){this.GlForm.reset({CrAmount:"",CurrencyId:null,DocDate:null,DocNo:null,DrAmount:"",ExRate:null,Id:0,LocalCrAmount:"",LocalDrAmount:"",Notes:""}),this.GlDetails=[],this.AppendRow(),this.AppendRow()}ResetPageApproveModel(){this.FromDateInput.FormControl.reset(this._AppModeService.DateNow()),this.ToDateInput.FormControl.reset(this._AppModeService.DateNow()),this.StatusInput.FormControl.reset(null)}AppoveCollection(){this.ResetPageApproveModel(),this.modalInstance=new window.bootstrap.Modal(this.modalRef.nativeElement)?.show()}SaveAppoveCollection(){if(this.FromDateInput.FormControl.valid==!1){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant(this.FromDateInput.LableName)),this._FocusService.focus(this.FromDateInput.FormControl);return}if(this.ToDateInput.FormControl.valid==!1){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant(this.ToDateInput.LableName)),this._FocusService.focus(this.ToDateInput.FormControl);return}if(this.StatusInput.FormControl.valid==!1){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant(this.StatusInput.LableName)),this._FocusService.focus(this.StatusInput.FormControl);return}let e={From:this._AppModeService.ConvertISODate(this.FromDateInput.FormControl.value),To:this._AppModeService.ConvertISODate(this.ToDateInput.FormControl.value),Boolean:this.StatusInput.FormControl.value!=1};if(this._AppModeService.ValidateDate(e.From,e.To).IsValid==!1){this._AppModeService._Toastr.error(this._AppModeService.ValidateDate(e.From,e.To).Message);return}this._Apiservice.post("GlEP/ApproveAll",e,!0).pipe(I(this._ServiceLifeTime.Destroyed$)).subscribe({next:n=>{this._AppModeService._Toastr.success(n.Message),this.ResetPageApproveModel(),window.bootstrap.Modal.getInstance(this.modalRef.nativeElement)?.hide(),this.DynamicComponent.LoadDataPaging(!0)}})}Appove(e){this.Send(e.Id,"true")}UnAppove(e){this.Send(e.Id,"false")}Send(e,n){this._Apiservice.get(`GlEP/Approve?Id=${e}&Boolean=${n}`,!0).pipe(I(this._ServiceLifeTime.Destroyed$)).subscribe({next:t=>{this._AppModeService._Toastr.success(t.Message),this.DynamicComponent.LoadDataPaging(!0)}})}};D.\u0275fac=function(n){return new(n||D)},D.\u0275cmp=b({type:D,selectors:[["app-gl"]],viewQuery:function(n,t){if(n&1&&(N(X,5),N(Y,5)),n&2){let r;w(r=G())&&(t.modalRef=r.first),w(r=G())&&(t.DynamicComponent=r.first)}},decls:66,vars:32,consts:[["dynamiccomponent",""],["modal",""],["Appovemodal",""],[3,"OpenModalEvent","ShowToEditeEvent","OutModal","EventArr","TablePaging"],["id","fullscreenModal","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-fullscreen"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel4",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"row","align-items-end"],[1,"col-12","col-sm-6","col-md-4","col-xl-1","p-1"],[3,"InputInfo"],[1,"col-12","col-sm-6","col-md-4","col-xl-2","p-1"],[3,"EventChange","InputInfo"],[1,"col-12","p-1","mt-2"],[1,"table","table-stripe","col-12"],[1,"col-3"],[4,"ngFor","ngForOf"],[3,"SaveEvent","UpdateEvent","CloseEvent","Id"],["id","exLargeModal","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-xl"],[1,"modal-body","row","align-items-end"],[1,"col-12","col-sm-6","col-md-4","col-xl-3","p-1"],[3,"SaveEvent","CloseEvent"],[1,"d-flex"],[1,"btn","btn-primary","py-1","mx-1",3,"click"],[1,"btn","btn-danger","py-1","mx-1",3,"click","disabled"]],template:function(n,t){if(n&1){let r=F();i(0,"app-dynamic-component",3,0),C("OpenModalEvent",function(){return u(r),d(t.GetPageInfo())})("ShowToEditeEvent",function(O){return u(r),d(t.ShowToEdite(O))}),o(),i(2,"div",4,1)(4,"div",5)(5,"div",6)(6,"div",7)(7,"h5",8),_(8),f(9,"translate"),o(),c(10,"button",9),o(),i(11,"div",10)(12,"div",11)(13,"div",12),c(14,"app-generic-input",13),o(),i(15,"div",14)(16,"app-gcdate",15),C("EventChange",function(){return u(r),d(t.ChangeCurrency())}),o()(),i(17,"div",14)(18,"app-gcdropdown",15),C("EventChange",function(){return u(r),d(t.ChangeCurrency())}),o()(),i(19,"div",12),c(20,"app-generic-input",13),o(),i(21,"div",12),c(22,"app-generic-input",13),o(),i(23,"div",12),c(24,"app-generic-input",13),o(),i(25,"div",12),c(26,"app-generic-input",13),o(),i(27,"div",12),c(28,"app-generic-input",13),o(),i(29,"div",14),c(30,"app-generic-input",13),o(),i(31,"div",16)(32,"table",17)(33,"thead")(34,"tr")(35,"th"),_(36,"#"),o(),i(37,"th",18),_(38),f(39,"translate"),o(),i(40,"th",18),_(41),f(42,"translate"),o(),i(43,"th",18),_(44),f(45,"translate"),o(),i(46,"th",18),_(47),f(48,"translate"),o()()(),i(49,"tbody"),R(50,Z,15,5,"tr",19),o()()()()(),i(51,"app-modal-footer",20),C("SaveEvent",function(){return u(r),d(t.Save())})("UpdateEvent",function(){return u(r),d(t.Save())})("CloseEvent",function(){return u(r),d(t.ResetPage())}),o()()()(),i(52,"div",21,2)(54,"div",22)(55,"div",6)(56,"div",7),c(57,"button",9),o(),i(58,"div",23)(59,"div",24),c(60,"app-gcdate",13),o(),i(61,"div",24),c(62,"app-gcdate",13),o(),i(63,"div",24),c(64,"app-gcstatic-drop-down",13),o()(),i(65,"app-modal-footer",25),C("SaveEvent",function(){return u(r),d(t.SaveAppoveCollection())})("CloseEvent",function(){return u(r),d(t.ResetPageApproveModel())}),o()()()()}if(n&2){let r=L(3);l("OutModal",r)("EventArr",t.EventArr)("TablePaging",t.TablePaging),a(8),V(" ",y(9,22,t.TablePaging.PageTitle)," "),a(6),l("InputInfo",t.DocNoInput),a(2),l("InputInfo",t.DocDateInput),a(2),l("InputInfo",t.CurrencyInput),a(2),l("InputInfo",t.ExRateInput),a(2),l("InputInfo",t.DrAmountInput),a(2),l("InputInfo",t.CrAmountInput),a(2),l("InputInfo",t.LocalDrAmountInput),a(2),l("InputInfo",t.LocalCrAmountInput),a(2),l("InputInfo",t.NotesInput),a(8),g(y(39,24,"Analysis")),a(3),g(y(42,26,"Name")),a(3),g(y(45,28,"Debit")),a(3),g(y(48,30,"Credit")),a(3),l("ngForOf",t.GlDetails),a(),l("Id",t.GlForm.get("Id").value),a(9),l("InputInfo",t.FromDateInput),a(2),l("InputInfo",t.ToDateInput),a(2),l("InputInfo",t.StatusInput)}},dependencies:[z,k,B,M,Q,H,J,W,$],encapsulation:2});let T=D;return T})();export{Ie as GlComponent};
