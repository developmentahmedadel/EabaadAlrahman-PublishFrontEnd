import{f as B,g as J,h as z,j as H}from"./chunk-5AEJKQZ7.js";import{l as m,m as _,n as q,q as Q}from"./chunk-33ESLUTY.js";import"./chunk-MFF7C7S5.js";import"./chunk-QU4V2ODD.js";import{c as F,f as U,g as s}from"./chunk-4DGYJU6A.js";import{b as K}from"./chunk-JRHJ5E23.js";import{c as k,d as $}from"./chunk-7XYIQRBA.js";import{c as P,d as M}from"./chunk-ZDDZZI4Y.js";import{c as L}from"./chunk-ZEZBUIIC.js";import{$ as A,Pc as f,Qc as T,Sb as a,Tb as o,Ub as i,Vb as C,ac as S,db as l,fc as h,hc as v,la as g,lc as w,mc as b,nc as V,qb as N,ra as u,rc as x,sa as c,vb as G,wc as D,xc as E,yc as R}from"./chunk-D2MV77EI.js";var X=["dynamiccomponent"];function Y(y,I){if(y&1){let d=S();o(0,"tr")(1,"td")(2,"div",20)(3,"button",21),h("click",function(){u(d);let n=v();return c(n.AppendRow())}),D(4," + "),i(),o(5,"button",22),h("click",function(){let n=u(d).index,t=v();return c(t.RemoveRow(n))}),D(6," - "),i()()(),o(7,"td")(8,"app-gcdropdown",14),h("EventChange",function(){let n=u(d),t=n.$implicit,r=n.index,p=v();return c(p.AnalysisScreenChange(t.AnalysisScreenId.FormControl.value,r))}),i()(),o(9,"td"),C(10,"app-gcdropdown",12),i(),o(11,"td")(12,"app-generic-input",14),h("EventChange",function(){let n=u(d).$implicit,t=v();return n.Credit.FormControl.setValue(null),c(t.CalcTotal())}),i()(),o(13,"td")(14,"app-generic-input",14),h("EventChange",function(){let n=u(d).$implicit,t=v();return n.Debit.FormControl.setValue(null),c(t.CalcTotal())}),i()()()}if(y&2){let d=I.$implicit,e=v();l(5),a("disabled",e.GlDetails.length==1),l(3),a("InputInfo",d.AnalysisScreenId),l(2),a("InputInfo",d.ReferenceId),l(2),a("InputInfo",d.Debit),l(2),a("InputInfo",d.Credit)}}var _e=(()=>{let I=class I{constructor(){this._ServiceLifeTime=g(P),this._FocusService=g(q),this._Apiservice=g(M),this._AppModeService=g(K),this.TablePaging={PageTitle:"Gl.Gl",Url:"Global/GetAll",TableName:"Gl",AddUrl:"GlEP/Add",UpdateUrl:"GlEP/Update",DeleteUrl:"GlEP/Delete",GetById:"GlEP/GetById",PrintUrl:"GL",Join:!0,JoinTables:["Currency Cur"],JoinConditions:["T.CurrencyId = Cur.Id"],Columns:["T.Id","T.DocNo","T.DocDate","T.ExRate","T.DrAmount","T.CrAmount","T.LocalDrAmount","T.LocalCrAmount",this._Apiservice.Language=="ar"?"Cur.NameAr As CurrencyName":"Cur.NameEn As CurrencyName"],TableCell:[{CellName:"DocNo",SortName:"T.DocNo",KeyValue:"DocNo"},{CellName:"DocDate",SortName:"T.DocDate",KeyValue:"DocDate",CellDate:!0},{CellName:"Gl.Currency",SortName:this._Apiservice.Language=="ar"?"Cur.NameAr":"Cur.NameEn",KeyValue:"CurrencyName"},{CellName:"ExRate",SortName:"T.ExRate",KeyValue:"ExRate"},{CellName:"Depit",SortName:"T.DrAmount",KeyValue:"DrAmount"},{CellName:"Credit",SortName:"T.CrAmount",KeyValue:"CrAmount"},{CellName:"LocalDrAmount",SortName:"T.LocalDrAmount",KeyValue:"LocalDrAmount"},{CellName:"LocalCrAmount",SortName:"T.LocalCrAmount",KeyValue:"LocalCrAmount"}]},this.GlDetails=[],this.GlForm=new U({Id:new s(0),DocNo:new s({value:"",disabled:!0}),DocDate:new s(null,[F.required]),CurrencyId:new s(null,[F.required]),DrAmount:new s({value:"0",disabled:!0}),CrAmount:new s({value:"0",disabled:!0}),LocalDrAmount:new s({value:"0",disabled:!0}),LocalCrAmount:new s({value:"0",disabled:!0}),ExRate:new s({value:"0",disabled:!0}),Notes:new s("")}),this.DocNoInput={LableName:"DocNo",FormControl:this.GlForm.get("DocNo"),FiledType:m.input,InputType:_.Text,Disabled:!0},this.DocDateInput={LableName:"DocDate",FormControl:this.GlForm.get("DocDate"),FiledType:m.Date},this.NotesInput={LableName:"Notes",FormControl:this.GlForm.get("Notes"),FiledType:m.input,InputType:_.Text},this.DrAmountInput={LableName:"T-Depit",FormControl:this.GlForm.get("DrAmount"),FiledType:m.input,InputType:_.Text},this.CrAmountInput={LableName:"T-Credit",FormControl:this.GlForm.get("CrAmount"),FiledType:m.input,InputType:_.Text},this.LocalDrAmountInput={LableName:"T-LocalDepit",FormControl:this.GlForm.get("LocalDrAmount"),FiledType:m.input,InputType:_.Text},this.LocalCrAmountInput={LableName:"T-LocalCredit",FormControl:this.GlForm.get("LocalCrAmount"),FiledType:m.input,InputType:_.Text},this.ExRateInput={LableName:"ExRate",FormControl:this.GlForm.get("ExRate"),FiledType:m.input,InputType:_.Text},this.CurrencyInput={LableName:"Gl.Currency",TableName:"Currency",Url:"Global/GetAll",Columns:["Id","NameAr","NameEn"],FormControl:this.GlForm.get("CurrencyId"),FiledType:m.DropDownApi}}ChangeCurrency(){let e=this.CurrencyInput.FormControl.value,n=this.DocDateInput.FormControl.value;if(e==null||n==null){this.SetExchangeRate("0");return}let t={CurrencyId:e,Date:n};this._Apiservice.post("CurrencyEP/GetRate",t,!1).pipe(A(this._ServiceLifeTime.Destroyed$)).subscribe({next:r=>this.SetExchangeRate(r.Obj),error:()=>this.SetExchangeRate("0")})}SetExchangeRate(e){this.ExRateInput.FormControl.setValue(e),this.CalcTotal()}GetPageInfo(){this.ResetPage(),this.DateNow(),this._Apiservice.get("GlEP/GetPageInfo",!1).pipe(A(this._ServiceLifeTime.Destroyed$)).subscribe({next:e=>{this.DocNoInput.FormControl.setValue(e.Obj)}})}DateNow(){this.DocDateInput.FormControl.setValue(this._AppModeService.DateNow())}AppendRow(e=null){this.GlDetails.push({AnalysisScreenId:{FormControl:new s(e!=null?e.AnalysisScreenId:null,[F.required]),FiledType:m.DropDownApi,Url:"Global/GetAll",TableName:"AnalysisScreen",Columns:["Id","NameAr","NameEn"],ValueField:"AnalysisScreenId",ValueFieldName:"AnalysisScreenName",ResponseData:e!=null?[{Id:e.AnalysisScreenId,NameAr:e.AnalysisScreenName,NameEn:e.AnalysisScreenName}]:[]},ReferenceId:{FormControl:new s(e!=null?e.ReferenceId:null),FiledType:m.DropDownApi,Columns:["Id"],ResponseData:e!=null?[{Id:e.ReferenceId,NameAr:e.ReferenceName,NameEn:e.ReferenceName}]:[]},Debit:{FormControl:new s(e!=null?e.Debit:null),FiledType:m.input,InputType:_.Text},Credit:{FormControl:new s(e!=null?e.Credit:null),FiledType:m.input,InputType:_.Text}})}RemoveRow(e){return this.GlDetails.length==1?(this._AppModeService._Toastr.error(this._AppModeService._Translate.instant("GlManual.Error.ErrorFirstRow")),!1):(this.GlDetails.splice(e,1),this.CalcTotal(),!0)}MappingList(){return this.GlDetails.map(n=>{let t={};return Object.keys(n).forEach(r=>{t[r]=Number(n[r].FormControl?.value)??null}),t})}CalcTotal(){this.DrAmountInput.FormControl.setValue(null),this.CrAmountInput.FormControl.setValue(null),this.LocalDrAmountInput.FormControl.setValue(null),this.LocalCrAmountInput.FormControl.setValue(null);let e=Number(this.ExRateInput.FormControl.value)||0,n=this.MappingList(),t=0,r=0;n.forEach(p=>{t+=Number(p.Debit)||0,r+=Number(p.Credit)||0}),this.DrAmountInput.FormControl.setValue(t),this.CrAmountInput.FormControl.setValue(r),this.LocalDrAmountInput.FormControl.setValue(t*e),this.LocalCrAmountInput.FormControl.setValue(r*e)}AnalysisScreenChange(e,n){let t=this.GlDetails[n];t.ReferenceId.Url="",t.ReferenceId.ResponseData=[],e>0&&(t.ReferenceId.Url=`AnalysisScreenEP/GetAllAnalysisScreen?Id=${e}`)}Save(){if(this.DocDateInput.FormControl.valid==!1){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant(this.DocDateInput.LableName)),this._FocusService.focus(this.DocDateInput.FormControl);return}if(this.CurrencyInput.FormControl.valid==!1){this._AppModeService._Toastr.error(this._AppModeService._Translate.instant(this.CurrencyInput.LableName)),this._FocusService.focus(this.CurrencyInput.FormControl);return}for(let n=0;n<this.GlDetails.length;n++){let t=this.GlDetails[n];for(let r of Object.keys(t)){let p=t[r].FormControl;if(p&&!p.valid){this._FocusService.focus(p);return}}}if(this.DrAmountInput.FormControl.value==null||this.CrAmountInput.FormControl.value==null)return;let e=this.GlForm.getRawValue();e.GlDetails=this.MappingList(),e.Id==0&&this._Apiservice.post("GlEP/Add",e,!0).pipe(A(this._ServiceLifeTime.Destroyed$)).subscribe({next:n=>{this._AppModeService._Toastr.success(n.Message),this.ResetPage(),this.DynamicComponent.LoadDataPaging(!0)}}),e.Id>0&&this._Apiservice.put("GlEP/Update",e,!0).pipe(A(this._ServiceLifeTime.Destroyed$)).subscribe({next:n=>{this._AppModeService._Toastr.success(n.Message),this.ResetPage(),this.DynamicComponent.LoadDataPaging(!0)}})}ShowToEdite(e){this.ResetPage(),this.GlForm.patchValue(e),this.DocDateInput.FormControl.setValue(new Date(e.DocDate)),this.CurrencyInput.ResponseData=[{Id:e.CurrencyId,NameAr:e.CurrencyName,NameEn:e.CurrencyName}],this.GlDetails=[];for(let n=0;n<e.GlDetails.length;n++){let t=e.GlDetails[n];this.AppendRow(t)}}ResetPage(){this.GlForm.reset({CrAmount:"",CurrencyId:null,DocDate:null,DocNo:null,DrAmount:"",ExRate:null,Id:0,LocalCrAmount:"",LocalDrAmount:"",Notes:""}),this.GlDetails=[],this.AppendRow(),this.AppendRow()}};I.\u0275fac=function(n){return new(n||I)},I.\u0275cmp=N({type:I,selectors:[["app-gl"]],viewQuery:function(n,t){if(n&1&&w(X,5),n&2){let r;b(r=V())&&(t.DynamicComponent=r.first)}},decls:52,vars:28,consts:[["dynamiccomponent",""],["modal",""],[3,"OpenModalEvent","ShowToEditeEvent","OutModal","TablePaging"],["id","fullscreenModal","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-fullscreen"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel4",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"row","align-items-end"],[1,"col-12","col-sm-6","col-md-4","col-xl-1","p-1"],[3,"InputInfo"],[1,"col-12","col-sm-6","col-md-4","col-xl-2","p-1"],[3,"EventChange","InputInfo"],[1,"col-12","p-1","mt-2"],[1,"table","table-stripe","col-12"],[1,"col-3"],[4,"ngFor","ngForOf"],[3,"SaveEvent","UpdateEvent","CloseEvent","Id"],[1,"d-flex"],[1,"btn","btn-primary","py-1","mx-1",3,"click"],[1,"btn","btn-danger","py-1","mx-1",3,"click","disabled"]],template:function(n,t){if(n&1){let r=S();o(0,"app-dynamic-component",2,0),h("OpenModalEvent",function(){return u(r),c(t.GetPageInfo())})("ShowToEditeEvent",function(W){return u(r),c(t.ShowToEdite(W))}),i(),o(2,"div",3,1)(4,"div",4)(5,"div",5)(6,"div",6)(7,"h5",7),D(8),f(9,"translate"),i(),C(10,"button",8),i(),o(11,"div",9)(12,"div",10)(13,"div",11),C(14,"app-generic-input",12),i(),o(15,"div",13)(16,"app-gcdate",14),h("EventChange",function(){return u(r),c(t.ChangeCurrency())}),i()(),o(17,"div",13)(18,"app-gcdropdown",14),h("EventChange",function(){return u(r),c(t.ChangeCurrency())}),i()(),o(19,"div",11),C(20,"app-generic-input",12),i(),o(21,"div",11),C(22,"app-generic-input",12),i(),o(23,"div",11),C(24,"app-generic-input",12),i(),o(25,"div",11),C(26,"app-generic-input",12),i(),o(27,"div",11),C(28,"app-generic-input",12),i(),o(29,"div",13),C(30,"app-generic-input",12),i(),o(31,"div",15)(32,"table",16)(33,"thead")(34,"tr")(35,"th"),D(36,"#"),i(),o(37,"th",17),D(38),f(39,"translate"),i(),o(40,"th",17),D(41),f(42,"translate"),i(),o(43,"th",17),D(44),f(45,"translate"),i(),o(46,"th",17),D(47),f(48,"translate"),i()()(),o(49,"tbody"),G(50,Y,15,5,"tr",18),i()()()()(),o(51,"app-modal-footer",19),h("SaveEvent",function(){return u(r),c(t.Save())})("UpdateEvent",function(){return u(r),c(t.Save())})("CloseEvent",function(){return u(r),c(t.ResetPage())}),i()()()()}if(n&2){let r=x(3);a("OutModal",r)("TablePaging",t.TablePaging),l(8),R(" ",T(9,18,t.TablePaging.PageTitle)," "),l(6),a("InputInfo",t.DocNoInput),l(2),a("InputInfo",t.DocDateInput),l(2),a("InputInfo",t.CurrencyInput),l(2),a("InputInfo",t.ExRateInput),l(2),a("InputInfo",t.DrAmountInput),l(2),a("InputInfo",t.CrAmountInput),l(2),a("InputInfo",t.LocalDrAmountInput),l(2),a("InputInfo",t.LocalCrAmountInput),l(2),a("InputInfo",t.NotesInput),l(8),E(T(39,20,"Analysis")),l(3),E(T(42,22,"Name")),l(3),E(T(45,24,"Debit")),l(3),E(T(48,26,"Credit")),l(3),a("ngForOf",t.GlDetails),l(),a("Id",t.GlForm.get("Id").value)}},dependencies:[H,$,B,L,Q,J,z,k],encapsulation:2});let y=I;return y})();export{_e as GlComponent};
