import{a as M,b as U}from"./chunk-M37KSZX3.js";import{j as S}from"./chunk-5AEJKQZ7.js";import{l as u,m as f}from"./chunk-33ESLUTY.js";import"./chunk-MFF7C7S5.js";import"./chunk-QU4V2ODD.js";import{c as T,g as p}from"./chunk-4DGYJU6A.js";import{b as I}from"./chunk-JRHJ5E23.js";import"./chunk-7XYIQRBA.js";import{c as F,d as D}from"./chunk-ZDDZZI4Y.js";import{l as w}from"./chunk-ZEZBUIIC.js";import{$ as C,Sb as b,Tb as s,Ub as m,Vb as y,ac as A,db as h,fc as v,la as c,lc as P,mc as E,nc as g,qb as _,ra as l,sa as d,wc as V}from"./chunk-D2MV77EI.js";var L=["modal"],W=(()=>{let r=class r{constructor(){this._ServiceLifeTime=c(F),this._AppModeService=c(I),this._Apiservice=c(D),this.EventArr=[{Name:"Tree",OnClick:()=>this.OpenTree()}],this.TablePaging={PageTitle:"CostCenter.CostCenter",Url:"Global/GetAll",TableName:"CostCenter",AddUrl:"CostCenterEP/Add",UpdateUrl:"CostCenterEP/Update",DeleteUrl:"CostCenterEP/Delete",Join:!0,JoinTables:["CostCenter Parent"],JoinConditions:["T.ParentId = Parent.Id"],Columns:["T.Id","T.Code","T.NameAr","T.NameEn","T.ParentId",this._Apiservice.Language=="ar"?"Parent.NameAr As ParentName":"Parent.NameEn As ParentName"],TableCell:[{CellName:"NameAr",SortName:"T.NameAr",KeyValue:"NameAr"},{CellName:"NameEn",SortName:"T.NameEn",KeyValue:"NameEn"},{CellName:"Code",SortName:"T.Code",KeyValue:"Code"},{CellName:"Parent",SortName:this._Apiservice.Language=="ar"?"Parent.NameAr":"Parent.NameEn",KeyValue:"ParentName"}]},this.Data=[{Type:"Tabs",TabName:"Basic Data",Tabs:[{TabName:"Data",TabData:[{FiledType:u.input,InputType:f.Text,FormControl:new p("",[T.required]),Required:!0,LableName:"NameAr",ValueField:"NameAr"},{FiledType:u.input,InputType:f.Text,FormControl:new p("",[T.required]),Required:!0,LableName:"NameEn",ValueField:"NameEn"},{FiledType:u.DropDownApi,FormControl:new p(null),LableName:"Parent",Url:"Global/GetAll",TableName:"CostCenter",Columns:["Id","NameAr","NameEn"],ValueField:"ParentId",ValueFieldName:"ParentName",OnChange:()=>this.ChangeParent()},{FiledType:u.input,InputType:f.Text,FormControl:new p({value:null,disabled:!0},[T.required]),LableName:"Code",ValueField:"Code"}]}]}],this.TreeJs=[]}ngAfterViewInit(){w(this._AppModeService._Toastr.platformId)&&(this.modalInstance=new window.bootstrap.Modal(this.modalRef.nativeElement,{keyboard:!1}))}GetCode(){let a=this.Data.flatMap(t=>t.Tabs??[]).flatMap(t=>t.TabData??[]).find(t=>t.ValueField==="Code");a&&this._Apiservice.getById("CostCenterEP/GetCode",0,!1).pipe(C(this._ServiceLifeTime.Destroyed$)).subscribe({next:t=>{a.FormControl.setValue(t.Obj)},error(t){a.FormControl.setValue(null)}})}ChangeParent(){let a=this.Data.flatMap(e=>e.Tabs??[]).flatMap(e=>e.TabData??[]).find(e=>e.ValueField==="Code"),t=this.Data.flatMap(e=>e.Tabs??[]).flatMap(e=>e.TabData??[]).find(e=>e.ValueField==="ParentId");if(t&&a){let e=t.FormControl.value==null?0:t.FormControl.value;this._Apiservice.getById("CostCenterEP/GetCode",e,!1).pipe(C(this._ServiceLifeTime.Destroyed$)).subscribe({next:n=>{a.FormControl.setValue(n.Obj)},error(n){a.FormControl.setValue(null)}})}}OpenTree(){let a={TableName:this.TablePaging.TableName,Columns:["Id","Code","NameAr","NameEn","ParentId"],Conditions:"",NoPaging:!0,BranchFilter:!0};this._Apiservice.post("Global/GetAll",a,!1).pipe(C(this._ServiceLifeTime.Destroyed$)).subscribe({next:t=>{this.HandleTree(t.Obj.DataReturn),this.modalInstance.show()}})}HandleTree(a){let t=[];for(let e=0;e<a.length;e++){let n=a[e];n.key=n.Id,n.icon="pi pi-fw pi-inbox",n.label=(this._Apiservice.Language=="ar"?n.NameAr:n.NameEn)+" - "+n.Code,n.data="Documents Folder",n.children=[],n.children=a.filter(i=>i.ParentId==n.Id),n.ParentId==null&&t.push(n)}this.TreeJs=t.sort((e,n)=>e.Code-n.Code)}nodeExpand(a){}nodeCollapse(a){}nodeSelect(a){}nodeUnselect(a){}expandRecursive(a,t){a.expanded=t,a.children&&a.children.forEach(e=>{this.expandRecursive(e,t)})}};r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=_({type:r,selectors:[["app-cost-center"]],viewQuery:function(t,e){if(t&1&&P(L,5),t&2){let n;E(n=g())&&(e.modalRef=n.first)}},decls:12,vars:4,consts:[["modal",""],[3,"OpenModalEvent","DataView","EventArr","TablePaging"],["id","modalCenter","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header","p-0","m-0"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body","p-0","text-center"],["selectionMode","single",1,"w-full",3,"onNodeExpand","onNodeCollapse","onNodeSelect","onNodeUnselect","value"],[1,"modal-footer","p-1"],["type","button","data-bs-dismiss","modal",1,"btn","btn-outline-secondary"]],template:function(t,e){if(t&1){let n=A();s(0,"app-dynamic-component",1),v("OpenModalEvent",function(){return l(n),d(e.GetCode())}),m(),s(1,"div",2,0)(3,"div",3)(4,"div",4)(5,"div",5),y(6,"button",6),m(),s(7,"div",7)(8,"p-tree",8),v("onNodeExpand",function(o){return l(n),d(e.nodeExpand(o))})("onNodeCollapse",function(o){return l(n),d(e.nodeCollapse(o))})("onNodeSelect",function(o){return l(n),d(e.nodeSelect(o))})("onNodeUnselect",function(o){return l(n),d(e.nodeUnselect(o))}),m()(),s(9,"div",9)(10,"button",10),V(11," Close "),m()()()()()}t&2&&(b("DataView",e.Data)("EventArr",e.EventArr)("TablePaging",e.TablePaging),h(8),b("value",e.TreeJs))},dependencies:[S,U,M],encapsulation:2});let N=r;return N})();export{W as CostCenterComponent};
